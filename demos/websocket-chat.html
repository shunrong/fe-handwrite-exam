<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket èŠå¤©å®¤æ¼”ç¤º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .demo-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .demo-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .demo-header h1 {
            margin: 0;
            margin-bottom: 10px;
        }
        
        .demo-header p {
            margin: 0;
            opacity: 0.9;
        }
        
        .back-link {
            display: inline-block;
            color: #007bff;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 8px 15px;
            border: 1px solid #007bff;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .back-link:hover {
            background: #007bff;
            color: white;
        }
        
        .info-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .info-section h2 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .feature-title {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        
        .feature-desc {
            font-size: 14px;
            color: #666;
        }
        
        .tech-stack {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .tech-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .tech-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
            border: 1px solid #bbdefb;
        }
        
        .demo-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .control-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .control-btn:hover {
            background: #0056b3;
        }
        
        .control-btn.secondary {
            background: #6c757d;
        }
        
        .control-btn.secondary:hover {
            background: #545b62;
        }
        
        .control-btn.success {
            background: #28a745;
        }
        
        .control-btn.success:hover {
            background: #1e7e34;
        }
        
        .note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }
        
        .note strong {
            color: #856404;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
    
    <div class="demo-container">
        <div class="demo-header">
            <h1>ğŸ’¬ WebSocket èŠå¤©å®¤æ¼”ç¤º</h1>
            <p>å®æ—¶é€šä¿¡åº”ç”¨çš„å®Œæ•´å®ç°</p>
        </div>
        
        <!-- èŠå¤©å®¤å®¹å™¨ -->
        <div id="chat-container"></div>
    </div>
    
    <div class="info-section">
        <h2>ğŸš€ åŠŸèƒ½ç‰¹æ€§</h2>
        
        <div class="feature-grid">
            <div class="feature-item">
                <div class="feature-title">å®æ—¶é€šä¿¡</div>
                <div class="feature-desc">åŸºäº WebSocket çš„åŒå‘å®æ—¶æ¶ˆæ¯ä¼ è¾“</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-title">ç”¨æˆ·ç®¡ç†</div>
                <div class="feature-desc">åœ¨çº¿ç”¨æˆ·åˆ—è¡¨å’ŒçŠ¶æ€æ˜¾ç¤º</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-title">æ¶ˆæ¯ç±»å‹</div>
                <div class="feature-desc">æ–‡æœ¬ã€è¡¨æƒ…ã€æ–‡ä»¶å’Œå›¾ç‰‡æ¶ˆæ¯</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-title">è¾“å…¥æŒ‡ç¤º</div>
                <div class="feature-desc">å®æ—¶æ˜¾ç¤ºç”¨æˆ·æ­£åœ¨è¾“å…¥çŠ¶æ€</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-title">è¿æ¥ç®¡ç†</div>
                <div class="feature-desc">è‡ªåŠ¨é‡è¿ã€å¿ƒè·³æ£€æµ‹å’ŒçŠ¶æ€ç›‘æ§</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-title">æ¶ˆæ¯å†å²</div>
                <div class="feature-desc">æœ¬åœ°å­˜å‚¨å’Œå†å²è®°å½•åŠ è½½</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-title">é€šçŸ¥ç³»ç»Ÿ</div>
                <div class="feature-desc">æ¡Œé¢é€šçŸ¥å’Œå£°éŸ³æé†’</div>
            </div>
            
            <div class="feature-item">
                <div class="feature-title">å“åº”å¼è®¾è®¡</div>
                <div class="feature-desc">é€‚é…æ¡Œé¢å’Œç§»åŠ¨ç«¯è®¾å¤‡</div>
            </div>
        </div>
        
        <div class="note">
            <strong>ğŸ“ æ¼”ç¤ºè¯´æ˜ï¼š</strong> 
            è¿™æ˜¯ä¸€ä¸ªå‰ç«¯æ¼”ç¤ºç‰ˆæœ¬ï¼Œä½¿ç”¨æ¨¡æ‹Ÿçš„ WebSocket æœåŠ¡å™¨ã€‚
            å®é™…éƒ¨ç½²æ—¶éœ€è¦é…åˆçœŸå®çš„ WebSocket æœåŠ¡å™¨åç«¯ã€‚
            ä½ å¯ä»¥æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ¨¡æ‹Ÿçš„ç½‘ç»œé€šä¿¡ã€‚
        </div>
    </div>
    
    <div class="demo-controls">
        <h2>ğŸ® æ¼”ç¤ºæ§åˆ¶</h2>
        <p>ä½¿ç”¨ä¸‹é¢çš„æŒ‰é’®æ¥æµ‹è¯•å„ç§åŠŸèƒ½ï¼š</p>
        
        <button class="control-btn" onclick="simulateUserJoin()">æ¨¡æ‹Ÿç”¨æˆ·åŠ å…¥</button>
        <button class="control-btn" onclick="simulateMessage()">æ¨¡æ‹Ÿæ¥æ”¶æ¶ˆæ¯</button>
        <button class="control-btn secondary" onclick="simulateDisconnect()">æ¨¡æ‹Ÿè¿æ¥æ–­å¼€</button>
        <button class="control-btn success" onclick="simulateReconnect()">æ¨¡æ‹Ÿé‡æ–°è¿æ¥</button>
        <button class="control-btn secondary" onclick="clearHistory()">æ¸…ç©ºå†å²è®°å½•</button>
    </div>
    
    <div class="info-section">
        <h2>âš™ï¸ æŠ€æœ¯å®ç°</h2>
        
        <div class="tech-stack">
            <h3>å‰ç«¯æŠ€æœ¯æ ˆ</h3>
            <div class="tech-list">
                <div class="tech-item">WebSocket API</div>
                <div class="tech-item">DOM æ“ä½œ</div>
                <div class="tech-item">äº‹ä»¶å¤„ç†</div>
                <div class="tech-item">æœ¬åœ°å­˜å‚¨</div>
                <div class="tech-item">Notification API</div>
                <div class="tech-item">File API</div>
                <div class="tech-item">å“åº”å¼ CSS</div>
                <div class="tech-item">æ¨¡å—åŒ–è®¾è®¡</div>
            </div>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px;">
            <h3>æ ¸å¿ƒå®ç°è¦ç‚¹</h3>
            <ul style="color: #666;">
                <li><strong>è¿æ¥ç®¡ç†ï¼š</strong>WebSocket ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é‡è¿ç­–ç•¥ã€å¿ƒè·³æœºåˆ¶</li>
                <li><strong>æ¶ˆæ¯å¤„ç†ï¼š</strong>æ¶ˆæ¯åºåˆ—åŒ–ã€ç±»å‹è¯†åˆ«ã€é¡ºåºä¿è¯</li>
                <li><strong>çŠ¶æ€åŒæ­¥ï¼š</strong>ç”¨æˆ·çŠ¶æ€ã€æˆ¿é—´ä¿¡æ¯ã€æ¶ˆæ¯å†å²åŒæ­¥</li>
                <li><strong>ç”¨æˆ·ä½“éªŒï¼š</strong>åŠ è½½çŠ¶æ€ã€é”™è¯¯å¤„ç†ã€ç¦»çº¿æ£€æµ‹</li>
                <li><strong>æ€§èƒ½ä¼˜åŒ–ï¼š</strong>æ¶ˆæ¯ç¼“å­˜ã€DOM æ›´æ–°ä¼˜åŒ–ã€å†…å­˜ç®¡ç†</li>
                <li><strong>å®‰å…¨è€ƒè™‘ï¼š</strong>æ¶ˆæ¯éªŒè¯ã€XSS é˜²æŠ¤ã€è¾“å…¥è¿‡æ»¤</li>
            </ul>
        </div>
        
        <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin-top: 20px;">
            <h3>æœåŠ¡å™¨ç«¯è¦æ±‚</h3>
            <ul style="color: #155724;">
                <li><strong>WebSocket æœåŠ¡å™¨ï¼š</strong>Node.js (Socket.IO)ã€Python (WebSockets)ã€Java (Spring WebSocket)</li>
                <li><strong>æˆ¿é—´ç®¡ç†ï¼š</strong>ç”¨æˆ·åŠ å…¥/ç¦»å¼€ã€æˆ¿é—´åˆ—è¡¨ã€æƒé™æ§åˆ¶</li>
                <li><strong>æ¶ˆæ¯å¹¿æ’­ï¼š</strong>æˆ¿é—´å†…å¹¿æ’­ã€ç§èŠã€ç³»ç»Ÿæ¶ˆæ¯</li>
                <li><strong>åœ¨çº¿çŠ¶æ€ï¼š</strong>ç”¨æˆ·åœ¨çº¿æ£€æµ‹ã€çŠ¶æ€åŒæ­¥ã€ç¦»çº¿æ¶ˆæ¯</li>
                <li><strong>æ•°æ®æŒä¹…åŒ–ï¼š</strong>æ¶ˆæ¯å†å²ã€ç”¨æˆ·ä¿¡æ¯ã€èŠå¤©è®°å½•</li>
                <li><strong>æ‰©å±•åŠŸèƒ½ï¼š</strong>æ–‡ä»¶ä¸Šä¼ ã€è¡¨æƒ…åŒ…ã€@æé†’ã€æ¶ˆæ¯æœç´¢</li>
            </ul>
        </div>
    </div>

    <script src="../scenarios/websocket-chat.js"></script>
    
    <script>
        let chatDemo;
        
        // åˆå§‹åŒ–èŠå¤©å®¤
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ’¬ WebSocket èŠå¤©å®¤æ¼”ç¤ºåˆå§‹åŒ–');
            
            try {
                // åˆ›å»ºèŠå¤©å®¤å®ä¾‹
                chatDemo = new WebSocketChatDemo();
                console.log('âœ… èŠå¤©å®¤åˆ›å»ºæˆåŠŸ');
            } catch (error) {
                console.error('âŒ èŠå¤©å®¤åˆ›å»ºå¤±è´¥:', error);
            }
        });
        
        // æ¼”ç¤ºæ§åˆ¶å‡½æ•°
        function simulateUserJoin() {
            if (chatDemo && chatDemo.chat) {
                chatDemo.simulateUser();
                console.log('ğŸ‘¤ æ¨¡æ‹Ÿç”¨æˆ·åŠ å…¥');
            }
        }
        
        function simulateMessage() {
            if (chatDemo && chatDemo.chat) {
                chatDemo.simulateMessage();
                console.log('ğŸ“ æ¨¡æ‹Ÿæ¥æ”¶æ¶ˆæ¯');
            }
        }
        
        function simulateDisconnect() {
            if (chatDemo && chatDemo.chat) {
                // æ¨¡æ‹Ÿè¿æ¥æ–­å¼€
                chatDemo.chat.ws.onclose({ code: 1006 });
                console.log('ğŸ”Œ æ¨¡æ‹Ÿè¿æ¥æ–­å¼€');
            }
        }
        
        function simulateReconnect() {
            if (chatDemo && chatDemo.chat) {
                // æ¨¡æ‹Ÿé‡æ–°è¿æ¥
                setTimeout(() => {
                    chatDemo.chat.connect();
                    console.log('ğŸ”„ æ¨¡æ‹Ÿé‡æ–°è¿æ¥');
                }, 1000);
            }
        }
        
        function clearHistory() {
            // æ¸…ç©ºæœ¬åœ°å­˜å‚¨
            localStorage.clear();
            
            // åˆ·æ–°é¡µé¢
            location.reload();
            
            console.log('ğŸ—‘ï¸ æ¸…ç©ºå†å²è®°å½•');
        }
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter å¿«é€Ÿå‘é€æ¶ˆæ¯
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                const messageInput = document.querySelector('.message-input');
                if (messageInput && messageInput.value.trim()) {
                    const sendBtn = document.querySelector('.send-btn');
                    if (sendBtn && !sendBtn.disabled) {
                        sendBtn.click();
                    }
                }
            }
        });
        
        // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        document.addEventListener('visibilitychange', function() {
            if (chatDemo && chatDemo.chat) {
                if (document.hidden) {
                    console.log('ğŸ“± é¡µé¢éšè—ï¼Œå¯ä»¥åœ¨è¿™é‡Œæš‚åœæŸäº›åŠŸèƒ½');
                } else {
                    console.log('ğŸ‘ï¸ é¡µé¢æ˜¾ç¤ºï¼Œæ¢å¤æ­£å¸¸åŠŸèƒ½');
                    // é‡ç½®æœªè¯»è®¡æ•°ç­‰
                    chatDemo.chat.state.unreadCount = 0;
                }
            }
        });
        
        // ç½‘ç»œçŠ¶æ€ç›‘å¬
        window.addEventListener('online', function() {
            console.log('ğŸŒ ç½‘ç»œå·²è¿æ¥');
            if (chatDemo && chatDemo.chat && !chatDemo.chat.state.connected) {
                chatDemo.chat.connect();
            }
        });
        
        window.addEventListener('offline', function() {
            console.log('ğŸ“´ ç½‘ç»œå·²æ–­å¼€');
        });
    </script>
</body>
</html>
