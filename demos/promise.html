<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promise å®ç°æ¼”ç¤º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .demo-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        
        .demo-section h2 {
            color: #28a745;
            margin-bottom: 15px;
        }
        
        .test-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .test-button:hover {
            background: #1e7e34;
        }
        
        .test-button.primary {
            background: #007bff;
        }
        
        .test-button.primary:hover {
            background: #0056b3;
        }
        
        .test-button.warning {
            background: #ffc107;
            color: #212529;
        }
        
        .test-button.warning:hover {
            background: #e0a800;
        }
        
        .test-button.danger {
            background: #dc3545;
        }
        
        .test-button.danger:hover {
            background: #c82333;
        }
        
        .result {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .promise-chain {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }
        
        .promise-state {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        
        .state-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .state-fulfilled {
            background: #d4edda;
            color: #155724;
        }
        
        .state-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .timeline {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            border-radius: 4px;
            background: #f8f9fa;
        }
        
        .timeline-time {
            background: #6c757d;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            margin-right: 10px;
            min-width: 50px;
            text-align: center;
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .back-link {
            display: inline-block;
            color: #007bff;
            text-decoration: none;
            margin-bottom: 20px;
            padding: 8px 15px;
            border: 1px solid #007bff;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .back-link:hover {
            background: #007bff;
            color: white;
        }
        
        .performance-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .performance-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }
        
        .performance-item h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 2s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
    
    <div class="demo-container">
        <h1>âš¡ Promise å®ç°æ¼”ç¤º</h1>
        
        <div class="demo-section">
            <h2>ğŸ¯ åŸºç¡€ Promise æµ‹è¯•</h2>
            <p>æµ‹è¯• Promise çš„åŸºæœ¬åŠŸèƒ½ï¼šresolveã€rejectã€thenã€catch</p>
            
            <button class="test-button" onclick="testBasicPromise()">æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
            <button class="test-button primary" onclick="testPromiseChain()">æµ‹è¯•é“¾å¼è°ƒç”¨</button>
            <button class="test-button warning" onclick="testAsyncResolve()">æµ‹è¯•å¼‚æ­¥resolve</button>
            <button class="test-button danger" onclick="testPromiseReject()">æµ‹è¯•Promiseæ‹’ç»</button>
            
            <div class="result" id="basic-result"></div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸ”— Promise é“¾å¼è°ƒç”¨</h2>
            <p>æµ‹è¯•å¤æ‚çš„é“¾å¼è°ƒç”¨å’Œé”™è¯¯ä¼ æ’­</p>
            
            <button class="test-button" onclick="testComplexChain()">å¤æ‚é“¾å¼è°ƒç”¨</button>
            <button class="test-button primary" onclick="testErrorPropagation()">é”™è¯¯ä¼ æ’­æµ‹è¯•</button>
            <button class="test-button warning" onclick="testFinally()">Finallyæ–¹æ³•</button>
            
            <div class="promise-chain" id="chain-visualization">
                <strong>é“¾å¼è°ƒç”¨å¯è§†åŒ–ï¼š</strong>
                <div id="chain-steps"></div>
            </div>
            
            <div class="result" id="chain-result"></div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸš€ Promise é™æ€æ–¹æ³•</h2>
            <p>æµ‹è¯• Promise.allã€Promise.raceã€Promise.allSettledã€Promise.any</p>
            
            <button class="test-button" onclick="testPromiseAll()">Promise.all</button>
            <button class="test-button primary" onclick="testPromiseRace()">Promise.race</button>
            <button class="test-button warning" onclick="testPromiseAllSettled()">Promise.allSettled</button>
            <button class="test-button danger" onclick="testPromiseAny()">Promise.any</button>
            
            <div class="timeline" id="static-timeline"></div>
            <div class="result" id="static-result"></div>
        </div>
        
        <div class="demo-section">
            <h2>âš¡ æ€§èƒ½å¯¹æ¯”æµ‹è¯•</h2>
            <p>å¯¹æ¯”åŸç”Ÿ Promise å’Œè‡ªå®ç° MyPromise çš„æ€§èƒ½</p>
            
            <button class="test-button" onclick="runPerformanceTest()">è¿è¡Œæ€§èƒ½æµ‹è¯•</button>
            
            <div class="performance-comparison" id="performance-results"></div>
            <div class="result" id="performance-detail"></div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸ§ª è¾¹ç•Œæƒ…å†µæµ‹è¯•</h2>
            <p>æµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µå’Œå¼‚å¸¸å¤„ç†</p>
            
            <button class="test-button" onclick="testEdgeCases()">è¾¹ç•Œæƒ…å†µ</button>
            <button class="test-button primary" onclick="testThenable()">Thenableå¯¹è±¡</button>
            <button class="test-button warning" onclick="testNestedPromise()">åµŒå¥—Promise</button>
            
            <div class="result" id="edge-result"></div>
        </div>
    </div>

    <script src="../vanilla-js/promise.js"></script>
    
    <script>
        let testStartTime = 0;
        let timelineContainer = null;
        
        // æ·»åŠ æ—¶é—´çº¿è®°å½•
        function addTimelineItem(content, container = 'static-timeline') {
            const timeline = document.getElementById(container);
            const elapsed = Date.now() - testStartTime;
            
            const item = document.createElement('div');
            item.className = 'timeline-item';
            item.innerHTML = `
                <div class="timeline-time">${elapsed}ms</div>
                <div class="timeline-content">${content}</div>
            `;
            
            timeline.appendChild(item);
        }
        
        // æ¸…ç©ºæ—¶é—´çº¿
        function clearTimeline(container = 'static-timeline') {
            document.getElementById(container).innerHTML = '';
            testStartTime = Date.now();
        }
        
        // æµ‹è¯•åŸºç¡€ Promise
        function testBasicPromise() {
            const result = document.getElementById('basic-result');
            
            result.textContent = 'å¼€å§‹æµ‹è¯•åŸºç¡€ Promise åŠŸèƒ½...\n';
            
            // æµ‹è¯•ç«‹å³resolve
            const promise1 = new MyPromise((resolve) => {
                resolve('ç«‹å³resolve');
            });
            
            promise1.then(value => {
                result.textContent += `âœ… ç«‹å³resolve: ${value}\n`;
                
                // æµ‹è¯•ç«‹å³reject
                const promise2 = new MyPromise((resolve, reject) => {
                    reject('ç«‹å³reject');
                });
                
                promise2.catch(error => {
                    result.textContent += `âœ… ç«‹å³reject: ${error}\n`;
                    
                    // æµ‹è¯•å¼‚æ­¥resolve
                    const promise3 = new MyPromise((resolve) => {
                        setTimeout(() => resolve('å¼‚æ­¥resolve'), 100);
                    });
                    
                    promise3.then(value => {
                        result.textContent += `âœ… å¼‚æ­¥resolve: ${value}\n`;
                        result.textContent += '\nğŸ‰ åŸºç¡€æµ‹è¯•å®Œæˆï¼';
                    });
                });
            });
            
            // å¯¹æ¯”åŸç”ŸPromise
            result.textContent += '\nå¯¹æ¯”åŸç”ŸPromise:\n';
            
            Promise.resolve('åŸç”Ÿresolve').then(value => {
                result.textContent += `ğŸ“ åŸç”ŸPromise: ${value}\n`;
            });
        }
        
        // æµ‹è¯• Promise é“¾
        function testPromiseChain() {
            const result = document.getElementById('basic-result');
            const steps = document.getElementById('chain-steps');
            
            result.textContent = 'å¼€å§‹æµ‹è¯• Promise é“¾å¼è°ƒç”¨...\n';
            steps.innerHTML = '';
            
            let stepCount = 0;
            
            function addStep(content, state = 'pending') {
                stepCount++;
                const step = document.createElement('div');
                step.innerHTML = `
                    <span class="promise-state state-${state}">æ­¥éª¤${stepCount}</span>
                    ${content}
                `;
                steps.appendChild(step);
                return step;
            }
            
            const step1 = addStep('åˆå§‹å€¼: 1');
            
            new MyPromise(resolve => {
                setTimeout(() => {
                    step1.querySelector('.promise-state').className = 'promise-state state-fulfilled';
                    resolve(1);
                }, 200);
            })
            .then(value => {
                const step2 = addStep(`+ 2 = ${value + 2}`, 'fulfilled');
                result.textContent += `ğŸ”— ç¬¬ä¸€æ­¥: ${value} + 2 = ${value + 2}\n`;
                return value + 2;
            })
            .then(value => {
                const step3 = addStep(`Ã— 3 = ${value * 3}`, 'fulfilled');
                result.textContent += `ğŸ”— ç¬¬äºŒæ­¥: ${value} Ã— 3 = ${value * 3}\n`;
                return value * 3;
            })
            .then(value => {
                const step4 = addStep(`æœ€ç»ˆç»“æœ: ${value}`, 'fulfilled');
                result.textContent += `ğŸ¯ æœ€ç»ˆç»“æœ: ${value}\n`;
                result.textContent += '\nâœ… é“¾å¼è°ƒç”¨æµ‹è¯•å®Œæˆï¼';
            })
            .catch(error => {
                result.textContent += `âŒ é“¾å¼è°ƒç”¨å¤±è´¥: ${error}\n`;
            });
        }
        
        // æµ‹è¯•å¼‚æ­¥resolve
        function testAsyncResolve() {
            const result = document.getElementById('basic-result');
            
            result.textContent = 'æµ‹è¯•å¼‚æ­¥resolveæ¨¡å¼...\n';
            
            const delays = [100, 300, 500];
            let completed = 0;
            
            delays.forEach((delay, index) => {
                const promise = new MyPromise(resolve => {
                    setTimeout(() => {
                        resolve(`å¼‚æ­¥ä»»åŠ¡${index + 1}å®Œæˆ (${delay}ms)`);
                    }, delay);
                });
                
                promise.then(value => {
                    completed++;
                    result.textContent += `âœ… ${value}\n`;
                    
                    if (completed === delays.length) {
                        result.textContent += '\nğŸ‰ æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼';
                    }
                });
            });
        }
        
        // æµ‹è¯•Promiseæ‹’ç»
        function testPromiseReject() {
            const result = document.getElementById('basic-result');
            
            result.textContent = 'æµ‹è¯•Promiseæ‹’ç»å’Œé”™è¯¯å¤„ç†...\n';
            
            // æµ‹è¯•åŒæ­¥reject
            new MyPromise((resolve, reject) => {
                reject(new Error('åŒæ­¥é”™è¯¯'));
            })
            .catch(error => {
                result.textContent += `âœ… æ•è·åŒæ­¥é”™è¯¯: ${error.message}\n`;
                
                // æµ‹è¯•å¼‚æ­¥reject
                return new MyPromise((resolve, reject) => {
                    setTimeout(() => {
                        reject(new Error('å¼‚æ­¥é”™è¯¯'));
                    }, 100);
                });
            })
            .catch(error => {
                result.textContent += `âœ… æ•è·å¼‚æ­¥é”™è¯¯: ${error.message}\n`;
                
                // æµ‹è¯•é”™è¯¯æ¢å¤
                return 'é”™è¯¯å·²æ¢å¤';
            })
            .then(value => {
                result.textContent += `âœ… é”™è¯¯æ¢å¤: ${value}\n`;
                result.textContent += '\nğŸ‰ é”™è¯¯å¤„ç†æµ‹è¯•å®Œæˆï¼';
            });
        }
        
        // æµ‹è¯•å¤æ‚é“¾å¼è°ƒç”¨
        function testComplexChain() {
            const result = document.getElementById('chain-result');
            
            result.textContent = 'å¼€å§‹å¤æ‚é“¾å¼è°ƒç”¨æµ‹è¯•...\n';
            
            new MyPromise(resolve => {
                setTimeout(() => resolve(10), 100);
            })
            .then(value => {
                result.textContent += `ğŸ”— åˆå§‹å€¼: ${value}\n`;
                if (value > 5) {
                    return new MyPromise(resolve => {
                        setTimeout(() => resolve(value * 2), 100);
                    });
                }
                return value;
            })
            .then(value => {
                result.textContent += `ğŸ”— æ¡ä»¶å¤„ç†å: ${value}\n`;
                // æŠ›å‡ºé”™è¯¯æµ‹è¯•
                if (value > 15) {
                    throw new Error(`å€¼å¤ªå¤§: ${value}`);
                }
                return value;
            })
            .catch(error => {
                result.textContent += `âš ï¸ æ•è·é”™è¯¯: ${error.message}\n`;
                return 5; // æ¢å¤
            })
            .then(value => {
                result.textContent += `ğŸ”— æ¢å¤å: ${value}\n`;
                return Promise.resolve(value + 1); // æ··åˆåŸç”ŸPromise
            })
            .then(value => {
                result.textContent += `ğŸ¯ æœ€ç»ˆå€¼: ${value}\n`;
                result.textContent += '\nâœ… å¤æ‚é“¾å¼è°ƒç”¨å®Œæˆï¼';
            });
        }
        
        // æµ‹è¯•é”™è¯¯ä¼ æ’­
        function testErrorPropagation() {
            const result = document.getElementById('chain-result');
            
            result.textContent = 'æµ‹è¯•é”™è¯¯ä¼ æ’­æœºåˆ¶...\n';
            
            new MyPromise(resolve => {
                resolve('æ­£å¸¸å¼€å§‹');
            })
            .then(value => {
                result.textContent += `âœ… æ­¥éª¤1: ${value}\n`;
                throw new Error('ä¸­é—´å‡ºé”™');
            })
            .then(value => {
                // è¿™é‡Œä¸åº”è¯¥æ‰§è¡Œ
                result.textContent += `âŒ ä¸åº”è¯¥æ‰§è¡Œ: ${value}\n`;
                return value;
            })
            .catch(error => {
                result.textContent += `ğŸš¨ æ•è·é”™è¯¯: ${error.message}\n`;
                return 'é”™è¯¯å·²å¤„ç†';
            })
            .then(value => {
                result.textContent += `âœ… ç»§ç»­æ‰§è¡Œ: ${value}\n`;
                result.textContent += '\nğŸ‰ é”™è¯¯ä¼ æ’­æµ‹è¯•å®Œæˆï¼';
            });
        }
        
        // æµ‹è¯•Finally
        function testFinally() {
            const result = document.getElementById('chain-result');
            
            result.textContent = 'æµ‹è¯•Finallyæ–¹æ³•...\n';
            
            // æˆåŠŸæƒ…å†µ
            new MyPromise(resolve => {
                setTimeout(() => resolve('æˆåŠŸç»“æœ'), 100);
            })
            .then(value => {
                result.textContent += `âœ… æˆåŠŸ: ${value}\n`;
                return value;
            })
            .finally(() => {
                result.textContent += `ğŸ Finally(æˆåŠŸ): æ¸…ç†å·¥ä½œ\n`;
            })
            .then(value => {
                result.textContent += `âœ… ç»§ç»­: ${value}\n`;
                
                // æµ‹è¯•å¤±è´¥æƒ…å†µ
                return new MyPromise((resolve, reject) => {
                    setTimeout(() => reject(new Error('å¤±è´¥ç»“æœ')), 100);
                });
            })
            .catch(error => {
                result.textContent += `âŒ å¤±è´¥: ${error.message}\n`;
                throw error;
            })
            .finally(() => {
                result.textContent += `ğŸ Finally(å¤±è´¥): æ¸…ç†å·¥ä½œ\n`;
            })
            .catch(error => {
                result.textContent += `ğŸ¯ æœ€ç»ˆæ•è·: ${error.message}\n`;
                result.textContent += '\nâœ… Finallyæµ‹è¯•å®Œæˆï¼';
            });
        }
        
        // æµ‹è¯•Promise.all
        function testPromiseAll() {
            const result = document.getElementById('static-result');
            clearTimeline();
            
            result.textContent = 'æµ‹è¯• Promise.all...\n';
            addTimelineItem('å¼€å§‹ Promise.all æµ‹è¯•');
            
            const promises = [
                new MyPromise(resolve => {
                    setTimeout(() => {
                        addTimelineItem('Promise 1 å®Œæˆ');
                        resolve('ç»“æœ1');
                    }, 200);
                }),
                new MyPromise(resolve => {
                    setTimeout(() => {
                        addTimelineItem('Promise 2 å®Œæˆ');
                        resolve('ç»“æœ2');
                    }, 100);
                }),
                new MyPromise(resolve => {
                    setTimeout(() => {
                        addTimelineItem('Promise 3 å®Œæˆ');
                        resolve('ç»“æœ3');
                    }, 300);
                })
            ];
            
            MyPromise.all(promises)
                .then(results => {
                    addTimelineItem('Promise.all å®Œæˆ');
                    result.textContent += `âœ… æ‰€æœ‰Promiseå®Œæˆ: [${results.join(', ')}]\n`;
                    result.textContent += `â±ï¸ æ€»ç”¨æ—¶: çº¦300ms (ç­‰å¾…æœ€æ…¢çš„)\n`;
                    result.textContent += '\nğŸ‰ Promise.all æµ‹è¯•å®Œæˆï¼';
                })
                .catch(error => {
                    result.textContent += `âŒ Promise.all å¤±è´¥: ${error}\n`;
                });
        }
        
        // æµ‹è¯•Promise.race
        function testPromiseRace() {
            const result = document.getElementById('static-result');
            clearTimeline();
            
            result.textContent = 'æµ‹è¯• Promise.race...\n';
            addTimelineItem('å¼€å§‹ Promise.race æµ‹è¯•');
            
            const promises = [
                new MyPromise(resolve => {
                    setTimeout(() => {
                        addTimelineItem('Promise 1 å®Œæˆ (æ…¢)');
                        resolve('æ…¢é€Ÿç»“æœ');
                    }, 300);
                }),
                new MyPromise(resolve => {
                    setTimeout(() => {
                        addTimelineItem('Promise 2 å®Œæˆ (å¿«)');
                        resolve('å¿«é€Ÿç»“æœ');
                    }, 100);
                }),
                new MyPromise(resolve => {
                    setTimeout(() => {
                        addTimelineItem('Promise 3 å®Œæˆ (ä¸­ç­‰)');
                        resolve('ä¸­ç­‰ç»“æœ');
                    }, 200);
                })
            ];
            
            MyPromise.race(promises)
                .then(result => {
                    addTimelineItem('Promise.race å®Œæˆ');
                    result.textContent += `ğŸƒ æœ€å¿«å®Œæˆ: ${result}\n`;
                    result.textContent += `â±ï¸ ç”¨æ—¶: çº¦100ms (æœ€å¿«çš„)\n`;
                    result.textContent += '\nğŸ‰ Promise.race æµ‹è¯•å®Œæˆï¼';
                });
        }
        
        // æµ‹è¯•Promise.allSettled
        function testPromiseAllSettled() {
            const result = document.getElementById('static-result');
            clearTimeline();
            
            result.textContent = 'æµ‹è¯• Promise.allSettled...\n';
            addTimelineItem('å¼€å§‹ Promise.allSettled æµ‹è¯•');
            
            const promises = [
                new MyPromise(resolve => {
                    setTimeout(() => {
                        addTimelineItem('Promise 1 æˆåŠŸ');
                        resolve('æˆåŠŸ1');
                    }, 100);
                }),
                new MyPromise((resolve, reject) => {
                    setTimeout(() => {
                        addTimelineItem('Promise 2 å¤±è´¥');
                        reject(new Error('å¤±è´¥2'));
                    }, 200);
                }),
                new MyPromise(resolve => {
                    setTimeout(() => {
                        addTimelineItem('Promise 3 æˆåŠŸ');
                        resolve('æˆåŠŸ3');
                    }, 150);
                })
            ];
            
            MyPromise.allSettled(promises)
                .then(results => {
                    addTimelineItem('Promise.allSettled å®Œæˆ');
                    result.textContent += 'ğŸ“Š æ‰€æœ‰Promiseå·²å¤„ç†:\n';
                    results.forEach((item, index) => {
                        if (item.status === 'fulfilled') {
                            result.textContent += `  âœ… Promise ${index + 1}: ${item.value}\n`;
                        } else {
                            result.textContent += `  âŒ Promise ${index + 1}: ${item.reason.message}\n`;
                        }
                    });
                    result.textContent += '\nğŸ‰ Promise.allSettled æµ‹è¯•å®Œæˆï¼';
                });
        }
        
        // æµ‹è¯•Promise.any
        function testPromiseAny() {
            const result = document.getElementById('static-result');
            clearTimeline();
            
            result.textContent = 'æµ‹è¯• Promise.any...\n';
            addTimelineItem('å¼€å§‹ Promise.any æµ‹è¯•');
            
            const promises = [
                new MyPromise((resolve, reject) => {
                    setTimeout(() => {
                        addTimelineItem('Promise 1 å¤±è´¥');
                        reject(new Error('å¤±è´¥1'));
                    }, 100);
                }),
                new MyPromise(resolve => {
                    setTimeout(() => {
                        addTimelineItem('Promise 2 æˆåŠŸ');
                        resolve('æˆåŠŸ2');
                    }, 200);
                }),
                new MyPromise((resolve, reject) => {
                    setTimeout(() => {
                        addTimelineItem('Promise 3 å¤±è´¥');
                        reject(new Error('å¤±è´¥3'));
                    }, 150);
                })
            ];
            
            MyPromise.any(promises)
                .then(value => {
                    addTimelineItem('Promise.any å®Œæˆ');
                    result.textContent += `ğŸ¯ é¦–ä¸ªæˆåŠŸ: ${value}\n`;
                    result.textContent += `â±ï¸ ç”¨æ—¶: çº¦200ms (é¦–ä¸ªæˆåŠŸçš„)\n`;
                    result.textContent += '\nğŸ‰ Promise.any æµ‹è¯•å®Œæˆï¼';
                })
                .catch(error => {
                    result.textContent += `âŒ æ‰€æœ‰Promiseéƒ½å¤±è´¥: ${error}\n`;
                });
        }
        
        // æ€§èƒ½æµ‹è¯•
        function runPerformanceTest() {
            const results = document.getElementById('performance-results');
            const detail = document.getElementById('performance-detail');
            
            detail.textContent = 'å¼€å§‹æ€§èƒ½æµ‹è¯•...\n';
            
            const iterations = 10000;
            
            // æµ‹è¯•åŸç”ŸPromise
            const nativeStart = performance.now();
            let nativePromises = [];
            
            for (let i = 0; i < iterations; i++) {
                nativePromises.push(
                    Promise.resolve(i).then(x => x * 2)
                );
            }
            
            Promise.all(nativePromises).then(() => {
                const nativeTime = performance.now() - nativeStart;
                
                // æµ‹è¯•MyPromise
                const myStart = performance.now();
                let myPromises = [];
                
                for (let i = 0; i < iterations; i++) {
                    myPromises.push(
                        MyPromise.resolve(i).then(x => x * 2)
                    );
                }
                
                MyPromise.all(myPromises).then(() => {
                    const myTime = performance.now() - myStart;
                    
                    results.innerHTML = `
                        <div class="performance-item">
                            <h4>åŸç”Ÿ Promise</h4>
                            <div><strong>${Math.round(nativeTime)}ms</strong></div>
                            <div>åŸºå‡†æ€§èƒ½</div>
                        </div>
                        <div class="performance-item">
                            <h4>MyPromise</h4>
                            <div><strong>${Math.round(myTime)}ms</strong></div>
                            <div>${Math.round(myTime / nativeTime * 100)}% ç›¸å¯¹æ€§èƒ½</div>
                        </div>
                    `;
                    
                    detail.textContent += `âš¡ æ€§èƒ½æµ‹è¯•ç»“æœ (${iterations} æ¬¡è¿­ä»£):\n`;
                    detail.textContent += `ğŸ“Š åŸç”ŸPromise: ${Math.round(nativeTime)}ms\n`;
                    detail.textContent += `ğŸ“Š MyPromise: ${Math.round(myTime)}ms\n`;
                    detail.textContent += `ğŸ“ˆ æ€§èƒ½æ¯”ä¾‹: ${Math.round(myTime / nativeTime * 100)}%\n`;
                    detail.textContent += `\nğŸ’¡ åˆ†æ:\n`;
                    detail.textContent += `- MyPromise æ˜¯å­¦ä¹ å®ç°ï¼Œæ€§èƒ½ç•¥ä½äºåŸç”Ÿå®ç°\n`;
                    detail.textContent += `- ä¸»è¦å·®å¼‚æ¥è‡ªäºè°ƒåº¦å’Œä¼˜åŒ–ç­–ç•¥\n`;
                    detail.textContent += `- åŠŸèƒ½å®Œæ•´æ€§æ¯”æ€§èƒ½æ›´é‡è¦`;
                });
            });
        }
        
        // è¾¹ç•Œæƒ…å†µæµ‹è¯•
        function testEdgeCases() {
            const result = document.getElementById('edge-result');
            
            result.textContent = 'æµ‹è¯•è¾¹ç•Œæƒ…å†µ...\n';
            
            // æµ‹è¯•å¤šæ¬¡resolve
            new MyPromise(resolve => {
                resolve('ç¬¬ä¸€æ¬¡');
                resolve('ç¬¬äºŒæ¬¡'); // åº”è¯¥è¢«å¿½ç•¥
            })
            .then(value => {
                result.textContent += `âœ… å¤šæ¬¡resolve: ${value} (åº”è¯¥æ˜¯"ç¬¬ä¸€æ¬¡")\n`;
                
                // æµ‹è¯•resolveåreject
                return new MyPromise((resolve, reject) => {
                    resolve('å·²è§£å†³');
                    reject('åç»­æ‹’ç»'); // åº”è¯¥è¢«å¿½ç•¥
                });
            })
            .then(value => {
                result.textContent += `âœ… resolveåreject: ${value}\n`;
                
                // æµ‹è¯•ç©ºPromise
                return new MyPromise(() => {
                    // æ°¸è¿œä¸è°ƒç”¨resolveæˆ–reject
                });
            })
            .then(value => {
                result.textContent += `âŒ è¿™è¡Œä¸åº”è¯¥æ‰§è¡Œ\n`;
            });
            
            // æµ‹è¯•ç«‹å³æ‰§è¡Œ
            setTimeout(() => {
                result.textContent += `â±ï¸ ç©ºPromiseä¿æŒpendingçŠ¶æ€\n`;
                result.textContent += '\nâœ… è¾¹ç•Œæƒ…å†µæµ‹è¯•å®Œæˆï¼';
            }, 500);
        }
        
        // æµ‹è¯•Thenableå¯¹è±¡
        function testThenable() {
            const result = document.getElementById('edge-result');
            
            result.textContent = 'æµ‹è¯•Thenableå¯¹è±¡...\n';
            
            // åˆ›å»ºthenableå¯¹è±¡
            const thenable = {
                then(onFulfilled, onRejected) {
                    setTimeout(() => {
                        onFulfilled('thenableç»“æœ');
                    }, 100);
                }
            };
            
            MyPromise.resolve(thenable)
                .then(value => {
                    result.textContent += `âœ… Thenableå¯¹è±¡: ${value}\n`;
                    
                    // æµ‹è¯•å¸¦æœ‰thenæ–¹æ³•çš„æ™®é€šå¯¹è±¡
                    const fakeThen = {
                        then: 'not a function'
                    };
                    
                    return MyPromise.resolve(fakeThen);
                })
                .then(value => {
                    result.textContent += `âœ… éå‡½æ•°then: ${JSON.stringify(value)}\n`;
                    result.textContent += '\nğŸ‰ Thenableæµ‹è¯•å®Œæˆï¼';
                });
        }
        
        // æµ‹è¯•åµŒå¥—Promise
        function testNestedPromise() {
            const result = document.getElementById('edge-result');
            
            result.textContent = 'æµ‹è¯•åµŒå¥—Promise...\n';
            
            new MyPromise(resolve => {
                resolve(
                    new MyPromise(innerResolve => {
                        setTimeout(() => {
                            innerResolve('å†…éƒ¨Promiseç»“æœ');
                        }, 100);
                    })
                );
            })
            .then(value => {
                result.textContent += `âœ… åµŒå¥—Promise: ${value}\n`;
                
                // æµ‹è¯•å¤šå±‚åµŒå¥—
                return new MyPromise(resolve => {
                    resolve(
                        new MyPromise(innerResolve => {
                            innerResolve(
                                new MyPromise(deepResolve => {
                                    setTimeout(() => {
                                        deepResolve('æ·±å±‚åµŒå¥—ç»“æœ');
                                    }, 100);
                                })
                            );
                        })
                    );
                });
            })
            .then(value => {
                result.textContent += `âœ… å¤šå±‚åµŒå¥—: ${value}\n`;
                result.textContent += '\nğŸ‰ åµŒå¥—Promiseæµ‹è¯•å®Œæˆï¼';
            });
        }
        
        // é¡µé¢åŠ è½½æç¤º
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âš¡ Promiseæ¼”ç¤ºé¡µé¢å·²åŠ è½½');
            console.log('ğŸ’¡ ç‚¹å‡»æµ‹è¯•æŒ‰é’®æŸ¥çœ‹Promiseå®ç°çš„å„ç§æ•ˆæœ');
            
            // æ·»åŠ è¯´æ˜
            document.querySelector('.demo-container').insertAdjacentHTML('afterbegin', `
                <div style="background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <strong>ğŸ’¡ æ¼”ç¤ºè¯´æ˜ï¼š</strong>
                    æœ¬æ¼”ç¤ºå±•ç¤ºäº†å®Œæ•´çš„Promiseå®ç°ï¼ŒåŒ…æ‹¬åŸºç¡€åŠŸèƒ½ã€é“¾å¼è°ƒç”¨ã€é™æ€æ–¹æ³•å’Œè¾¹ç•Œæƒ…å†µå¤„ç†ã€‚
                    ä½ å¯ä»¥çœ‹åˆ°MyPromiseä¸åŸç”ŸPromiseçš„è¡Œä¸ºå¯¹æ¯”ï¼Œä»¥åŠè¯¦ç»†çš„æ‰§è¡Œæ—¶é—´çº¿ã€‚
                </div>
            `);
        });
    </script>
</body>
</html>
